---
import { createRenderer } from 'studiocms:component-registry/runtime';
import { preRender } from 'studiocms:md/pre-render';
import type { PluginPageTypeRendererProps } from 'studiocms/types';
import { shared } from '../lib/shared.js';

// Get the pre-renderer for Markdown Content
const preRenderer = preRender();

// @ts-expect-error - $$result is a global variable injected by Astro during compilation and not a editor-known variable
const ssrResult: SSRResult = $$result;

// Define render function
const render = await createRenderer(ssrResult, shared.mdConfig?.sanitize, preRenderer);

interface Props extends PluginPageTypeRendererProps {}

// Get default content
const { defaultContent } = Astro.props.data;

// Get content to render
const contentToRender = defaultContent?.content || '# Error: No content found';

// Render content
const renderedContent = await render(contentToRender);
---

<Fragment set:html={renderedContent} />
