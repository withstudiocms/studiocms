---
import Config from 'virtual:studiocms/config';
import { headDefaults } from '../helpers/headDefaults';
import { type HeadConfig, type HeadUserConfig, createHead } from '../lib';

let htmlDefaultHead: HeadUserConfig = [];
let configFav = '';

if (Config?.defaultFrontEndConfig) {
	if (
		typeof Config.defaultFrontEndConfig === 'object' &&
		Config.defaultFrontEndConfig.htmlDefaultHead
	) {
		htmlDefaultHead.push(...Config.defaultFrontEndConfig.htmlDefaultHead);
	}

	if (typeof Config.defaultFrontEndConfig === 'object' && Config.defaultFrontEndConfig.favicon) {
		configFav = Config.defaultFrontEndConfig.favicon;
	}
}

interface Props {
	title: string;
	description: string;
	favicon: string;
	lang?: string;
	ogImage?: string;
	canonicalURL?: URL;
}

const canonical = Astro.site ? new URL(Astro.url.pathname, Astro.site) : undefined;

const {
	title,
	description,
	favicon = configFav,
	canonicalURL = canonical,
	lang = 'en',
	ogImage,
} = Astro.props;

const genericHead = headDefaults(title, description, lang, Astro, favicon, ogImage, canonicalURL);

const head = createHead(genericHead, htmlDefaultHead as HeadConfig);
---

{head.map(({ tag: Tag, attrs, content }) => <Tag {...attrs} set:html={content} />)}