---
import { Card, Icon } from 'studiocms:ui/components';
import type { HeroIconName } from '@studiocms/ui/components/Icon/iconType.js';
import { type SanitizeOptions } from 'ultrahtml/transformers/sanitize';
import { createComponentProxy, transformHTML } from '../../../utils/AstroComponentProxy';

export interface Props {
	span: 1 | 2 | 3;
	variant: 'default' | 'filled';
	header?: {
		title: string;
		icon?: HeroIconName;
	};
	body?: {
		html: string;
		// biome-ignore lint/suspicious/noExplicitAny: <explanation>
		components?: Record<string, any>;
		sanitizeOpts?: SanitizeOptions;
	};
}

const { span, variant, body, header } = Astro.props;

// @ts-ignore
const components = createComponentProxy($$result, body?.components);

let html: string | undefined = undefined;

if (body?.html) {
	html = await transformHTML(body.html, components, body.sanitizeOpts);
}
---
<Card
    fullWidth
    variant={variant}
    class="grid-item"
    class:list={[span > 1 && `span-${span}`]}>
    {header && (
        <div slot="header">
            <span class="grid-item-title">
                {header.icon && <Icon name={header.icon} width={24} height={24}/>}
                <span>{header.title}</span>
            </span>
        </div>
    )}
    { html && <Fragment set:html={html} /> }
</Card>