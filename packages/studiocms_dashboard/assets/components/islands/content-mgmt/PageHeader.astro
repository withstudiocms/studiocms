---
import { StudioCMSRoutes } from 'studiocms:lib';
import { Button, Group, Icon } from 'studiocms:ui/components';

interface Props {
	editPage?: boolean;
	createPage?: boolean;
	title?: string;
}

const { editPage, createPage, title = 'Content Management' } = Astro.props;
---
<header class="page-header">
  <div class="page-title-container">
    <h1 class="page-title" data-link={StudioCMSRoutes.sdk.pages}>{title}</h1>
  </div>
  <div id="page-actions-container" class="page-actions-container">

    { editPage && ( 
      <Button id="edit-button" variant="solid" size="sm"  color="primary" type="submit" form="edit-page-form">
        <Icon slot="start-content" name="check-20-solid" width={20} height={20} />
        Save Changes
      </Button>
    )}

    {createPage && ( 
      <Group>
      <Button id="draft-button" variant="outlined" size="sm" color="primary" type="submit" form="page-create-form" disabled>
        <Icon slot="start-content" name="document-text-20-solid" width={20} height={20} />
        Save Draft
      </Button>
      <Button id="publish-button" variant="solid" size="sm"  color="primary" type="submit" form="page-create-form">
        <Icon slot="start-content" name="check-20-solid" width={20} height={20} />
        Publish
      </Button>
      </Group>
    )}
  </div>
</header>

<script>
    async function listener() {
        // get the query parameters
        const urlParams = new URLSearchParams(window.location.search);
  
        // get the elements to customize
        const pageTitle = document.querySelector('.page-title') as HTMLElement;
    
        // get the id parameter
        const edit = window.location.pathname.includes('edit') ? urlParams.get('edit') : null;
        if (edit) {
            const pageDataResponse = await (await fetch(pageTitle.dataset.link!)).json();
            const currentPageData = pageDataResponse.pages.find((page: { data: { id: string; }; }) => page.data.id === edit);

            pageTitle.innerText = `Edit Page: ${currentPageData.data.title}`;
        } 
    }
    document.addEventListener('astro:after-swap', () => listener());
    listener();
  </script>


<style>
.page-header {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}

.page-title-container {
  display: flex;
  flex-direction: column;
  gap: .5rem;
  width: fit-content;
}

.page-title {
  display: block;
  width: fit-content;
  margin: 0;
}

.page-actions-container {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 1rem;
}
</style>
