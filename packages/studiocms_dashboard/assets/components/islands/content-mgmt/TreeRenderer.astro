---
import { StudioCMSRoutes } from 'studiocms:lib';
import type { FolderNode } from '@studiocms/core/sdk-utils/types';
import TreeSidebarFolder from './TreeSidebarFolder.astro';
import TreeSidebarLink from './TreeSidebarLink.astro';

// Props passed to the component
interface Props {
	data: FolderNode[];
}

const { data } = Astro.props;

/**
 * Recursively sorts a tree of pages and folders by name (A to Z).
 * @param data - The array of folders and pages to sort.
 * @returns A new array with the sorted structure.
 */
function sortTree(data: FolderNode[]): FolderNode[] {
	return data
		.map((node) => ({
			...node,
			children: sortTree(node.children), // Recursively sort children
		}))
		.sort((a, b) => a.name.localeCompare(b.name)); // Sort current level by name
}

const sortedData = sortTree(data);
---

{sortedData.map(({ id, name, page, children }) => (
    page ? (
        <TreeSidebarLink icon="document-text" href={`${StudioCMSRoutes.mainLinks.contentManagementEdit}/?edit=${id}`}>
            {name}
        </TreeSidebarLink>
    ) : (
        <TreeSidebarFolder {name} icon="folder" href={`${StudioCMSRoutes.mainLinks.contentManagementFolderEdit}/?folder=${id}`}>
            {children && children.length > 0 && (
                <div class="inner-sidebar-folder-child-nodes">
                    <Astro.self data={children} />
                </div>
            )}
        </TreeSidebarFolder>
    )
))}

<style>
    .inner-sidebar-folder-child-nodes {
        margin-left: 0.5rem;
        border-left: 2px solid hsl(var(--border));
}
</style>