---
import UserListItem from '../../../components/islands/user-mgmt/UserListItem.astro';

export const partial = true;

async function setContent() {
	const jsonData:
		| {
				users: {
					id: string;
					name: string;
					email: string | null;
					avatar: string | null;
					username: string;
					permissionsData:
						| {
								user: string;
								rank: string;
						  }
						| undefined;
				}[];
				searchQuery?: string;
		  }
		| undefined = await Astro.request.json();

	if (jsonData) {
		return jsonData;
	}

	return 'No Users to display';
}

const Users = await setContent();
---
{ 
	typeof Users !== 'string' 
	? Users.users.map((user) => <UserListItem user={user} searchQuery={Users.searchQuery} />) 
	: Users 
}