---
import { getSiteConfig } from 'studiocms:helpers/contentHelper';
import { StudioCMSRoutes } from 'studiocms:helpers/routemap';
import { Card, Divider } from '@matthiesenxyz/astrolace/components';
import { toPascalCase } from '@matthiesenxyz/integration-utils/textFormatters';
import { Layout } from '../components';
import CrumbStack from '../components/CrumbStack.astro';
import { makePageTitle } from '../utils';

import { getUserData } from 'studiocms:auth/lib/user';

const user = await getUserData(Astro);

if (!user.user) {
	return Astro.redirect(StudioCMSRoutes.authLinks.loginURL);
}

const {
	permissionLevel,
	user: { name, username, url },
} = user;

const {
	mainLinks: { dashboardIndex, userProfile },
} = StudioCMSRoutes;

const contextConfig = await getSiteConfig();
---

<Layout 
    sideBarActiveItemID="profile" 
    title={makePageTitle("User Profile", contextConfig)}
    description={contextConfig.description} >

    <CrumbStack
        isDashboard 
        items={[
            { href: dashboardIndex, text: 'Dashboard' },
            { href: userProfile, text: 'User Profile' }
        ]} />

    <div class="container">

        <h1 class="text-5xl font-bold py-8">User Profile</h1>


        <Card class="card-header">
            <div slot="header" class="text-5xl font-bold">
                {username}'s Profile
            </div>
            <Divider class="divider" />
            <div class="py-2">
                <span class="text-lg">
                    <strong>Display Name:</strong> {name}
                </span>
                <Divider />
                <span class="text-lg">
                    <strong>Role:</strong> {toPascalCase(permissionLevel)}
                </span>
                <Divider />
                { url && (
                    <span class="text-lg">
                        <strong>Url:</strong> <a class="text-blue" href={url}>{url}</a>
                    </span>
                <Divider />
                )}
            </div>
        </Card>


    </div>
</Layout>
