---
import Icon from '@studiocms/ui/utils/Icon.astro';
import type { HeroIconName } from '@studiocms/ui/utils/iconType.ts';
import type { HTMLAttributes } from 'astro/types';

interface Props extends HTMLAttributes<'a'> {
	/**
	 * ONLY USE OUTLINED ICONS! Shit will break otherwise
	 */
	icon: HeroIconName;
	href: string;
}

const { icon, ...props } = Astro.props;

const activeIcon = `${icon}-solid`;
---

<a id={`${icon}-link`} class="sidebar-link" {...props}>
  <Icon name={icon} class='sidebar-link-icon not-selected' width={24} height={24} />
  <Icon name={activeIcon as HeroIconName} class="sidebar-link-icon selected" width={24} height={24} />
  <span class="sidebar-link-text">
    <slot />
  </span>
</a>

<script is:inline data-astro-rerun>
  function setSidebarLinks() {
    const sidebarLinks = document.querySelectorAll('.sidebar-link');
    console.log('sidebarLinks', sidebarLinks);

    for (const link of sidebarLinks) {
      const id = link.id;

      const notSelectedIcon = link.querySelector('.not-selected')
      const selectedIcon = link.querySelector('.selected')

      notSelectedIcon.style.display = 'block';
      selectedIcon.style.display = 'none';
      link.classList.remove('active');

      if (new URL(link.href).pathname === window.location.pathname) {
        notSelectedIcon.style.display = 'none';
        selectedIcon.style.display = 'block';
        link.classList.add('active');
      }
    }
  }
  document.addEventListener('astro:page-load', setSidebarLinks());
  setSidebarLinks();
</script>

<style>
  .sidebar-link {
    display: flex;
    flex-direction: row;
    gap: .5rem;
    align-items: center;
    border-radius: .5rem;
    transition: all .15s ease;
    width: 100%;
    padding: .375rem .5rem;
    text-decoration: none;
    color: hsl(var(--text-muted));
  }

  .not-selected {
    display: block;
  }

  .selected {
    display: none;
  }

  .sidebar-link:hover {
    background-color: hsl(var(--background-step-2));
  }

  .sidebar-link.active {
    color: hsl(var(--text));
  }

  .sidebar-link.active .sidebar-link-icon {
    color: hsl(var(--primary-base));
  }
</style>
