---
import { pageTypeComponents } from '../../../../../components/dashboard/islands/content-mgmt/shared.js';

export const partial = true;

async function setContent() {
	const jsonData: { content: string | undefined; editor: string } | undefined =
		await Astro.request.json();

	const editors = await pageTypeComponents();

	let currentEditor = editors.find((ed) => {
		if (ed.identifier === jsonData?.editor) {
			return ed;
		}
	});

	if (!currentEditor) {
		// biome-ignore lint/style/noNonNullAssertion: <explanation>
		currentEditor = editors.find((editor) => editor.identifier === 'studiocms/markdown')!;
	}

	if (jsonData?.content) {
		return { content: jsonData.content, ActiveEditor: currentEditor.Component };
	}

	return { content: 'No content to display', ActiveEditor: currentEditor.Component };
}

const { content, ActiveEditor } = await setContent();
---
<ActiveEditor content={content} />