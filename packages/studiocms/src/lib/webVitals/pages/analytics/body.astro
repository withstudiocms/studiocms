---
import { Accordion, AccordionItem, Card, Divider, TabItem, Tabs } from 'studiocms:ui/components';
import { CoreWebVitals } from '../../consts.js';
import SummaryCard from '../../dashboard-grid-items/SummaryCard.astro';
import { getWebVitals } from '../../webVital.js';

const webVitals = await getWebVitals();

const twentyFourHourSummary = CoreWebVitals.map((metric) => ({
	metric,
	summary: webVitals.twentyFourHours.summary[metric],
}));

const sevenDaySummary = CoreWebVitals.map((metric) => ({
	metric,
	summary: webVitals.sevenDays.summary[metric],
}));

const thirtyDaySummary = CoreWebVitals.map((metric) => ({
	metric,
	summary: webVitals.thirtyDays.summary[metric],
}));

const summaries = CoreWebVitals.map((metric) => ({
	metric,
	summary: webVitals.summary[metric],
}));
---
<div class="analytics-container">
    <Card fullWidth>
        <div slot="header"><span>Core Web Vitals Summaries</span></div>
        <Tabs variant='starlight'>
            <TabItem label='24 Hours'>
                <div class="flex-wrap">
                    {twentyFourHourSummary.map(({ metric, summary }) => (
                        <SummaryCard {metric} {summary} />
                    ))}
                </div>
            </TabItem>
            <TabItem label='7 Days'>
                <div class="flex-wrap">
                    {sevenDaySummary.map(({ metric, summary }) => (
                        <SummaryCard {metric} {summary} />
                    ))}
                </div>
            </TabItem>
            <TabItem label='30 Days'>
                <div class="flex-wrap">
                    {thirtyDaySummary.map(({ metric, summary }) => (
                        <SummaryCard {metric} {summary} />
                    ))}
                </div>
            </TabItem>
            <TabItem label='All Time'>
                <div class="flex-wrap">
                    {summaries.map(({ metric, summary }) => (
                        <SummaryCard {metric} {summary} />
                    ))}
                </div>
            </TabItem>
        </Tabs>
    </Card>

    <Card fullWidth>
        <div slot="header"><span>Core Web Vitals by Route</span></div>
    </Card>

</div>

<style>
    .analytics-container {
        padding-left: 1rem;
        padding-right: 1rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .flex-wrap {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: .5rem;
        margin-bottom: 1rem;
    }
</style>