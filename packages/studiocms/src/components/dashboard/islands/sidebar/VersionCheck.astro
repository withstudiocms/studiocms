---
import studioCMS_SDK_Cache from 'studiocms:sdk/cache';
import { Button } from 'studiocms:ui/components';
import currentVersion from 'studiocms:version';
import { compare } from 'semver';

const latestVersion = await studioCMS_SDK_Cache.GET.latestVersion();
const comparison = compare(currentVersion, latestVersion.version);
const status = comparison === -1 ? 'outdated' : comparison === 0 ? 'latest' : 'future';
---

<Button size="sm" variant="flat" class="version-container" id="version-modal-trigger" title="Click for more information" aria-label="Click for more information">
    <code class="version-check">
        <span>v{currentVersion}</span>
        {status && <span class="status" class:list={[status]} />}
    </code>
</Button>

<style>
    .version-container {
        width: 100%;
    }

    .version-check {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
        font-weight: 500;
    }

    .status {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }

    .outdated {
        background-color: hsl(var(--danger-base));
    }

    .latest {
        background-color: hsl(var(--success-base));
    }

    .future {
        background-color: hsl(var(--warning-base));
    }
</style>
