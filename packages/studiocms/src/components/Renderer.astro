---
import { pluginRenderers } from 'studiocms:plugins/renderers';
import type { CombinedPageData } from 'studiocms:sdk/types';
import * as renderers from 'virtual:studiocms/plugins/renderers';

type DeepPartial<T> = {
	[P in keyof T]?: T[P] extends object ? DeepPartial<T[P]> : T[P];
};

type Data = DeepPartial<CombinedPageData>;

interface Props {
	data: Data;
}

const { data } = Astro.props;

if (!data) return;

const renderer = pluginRenderers.find((r) => r.pageType === data.package);

if (!renderer) return;

// @ts-ignore - This is a dynamic import
const RendererModule = renderers[renderer.safePageType];

if (!RendererModule) return;
---
<RendererModule {data} />