---
import { convertUnderscoresToHyphens } from 'studiocms:component-registry/runtime';
import type { UiLanguageKeys } from 'studiocms:i18n';
import { Card } from 'studiocms:ui/components/card';
import { Icon } from 'studiocms:ui/components/icon';
import { createComponentProxy, transformHTML } from '../../../runtime/index.js';
import type { GridItemUsable as GridItem } from '../../../schemas/plugins/shared.js';

export interface Props extends GridItem {
	lang: UiLanguageKeys;
}

const { span, variant, body, header, name } = Astro.props;

// @ts-expect-error - `$$result` is a global variable injected by Astro's compiler during rendering
const components = createComponentProxy($$result, body?.components);

let html: string | undefined;

if (body?.html) {
	html = await transformHTML(body.html, components, body.sanitizeOpts);
}

const [pluginId, componentSafeId] = name.split('/');

const componentId = convertUnderscoresToHyphens(componentSafeId);

const genericTranslationProps = {
	plugin: pluginId,
	component: componentId,
};
---
<Card
    fullWidth
    variant={variant}
    class="grid-item"
    class:list={[span > 1 && `span-${span}`]}
    id={name}>
    {header && (
        <div slot="header">
            <span class="grid-item-title">
                {header.icon && <Icon name={header.icon} width={24} height={24}/>}
                <span><p-translations {...genericTranslationProps} key="title">{header.title}</p-translations></span>
            </span>
        </div>
    )}
    { html && <Fragment set:html={html} /> }
</Card>
