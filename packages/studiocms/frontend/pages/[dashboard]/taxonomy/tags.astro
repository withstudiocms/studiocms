---
import { useTranslations } from 'studiocms:i18n';
import InnerSidebarElement from '#frontend/components/dashboard/taxonomy/InnerSidebarElement.astro';
import PageHeader from '#frontend/components/dashboard/taxonomy/PageHeader.astro';
import DashboardLayout from '#frontend/layouts/DashboardLayout.astro';

const { siteConfig: config, defaultLang: lang, security } = Astro.locals.StudioCMS;

const currentUser = security?.userSessionData ?? null;

const t = useTranslations(lang, '@studiocms/dashboard:taxonomy-index');

const searchParams = Astro.url.searchParams;

const mode = (searchParams.get('mode') as 'create' | 'edit' | null) ?? undefined;
const editId = searchParams.get('edit') ?? undefined;

let pageTitle: string | undefined;

if (mode === 'edit') {
	// TODO: get the actual tag name from the ID
	pageTitle = editId;
}
---

<DashboardLayout
    title={t("title")}
    description={t("description")}
    requiredPermission="editor"
    sidebar="double"
    {lang}
    {config}
    {currentUser}
>
    <div slot="double-sidebar" class="inner-sidebar-container">
        <div class="sidebar-links-container">
            <InnerSidebarElement {lang} />
        </div>
    </div>

    <div slot="header">
        <PageHeader {lang} type='tags' {mode} {pageTitle} />
    </div>

    {/* Page Content Placeholder */}
</DashboardLayout>

<style>
    .inner-sidebar-container {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        min-height: 100vh;
        max-height: 100%;
        padding: 1.5rem;
    }

    .sidebar-links-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
        min-height: 95vh;
        height: 100%;
        gap: 0.5rem;
    }
</style>

<script>
    import {
        $i18n,
        $localeSettings,
        baseTranslation,
        defaultLang,
        documentUpdater,
        makeTranslation,
    } from "studiocms:i18n/client";

    let lang = defaultLang;

    const currentPage = "@studiocms/dashboard:taxonomy-index";

    $localeSettings.subscribe((locale) => {
        lang = locale || defaultLang;
    });

    const i18n = $i18n(currentPage, baseTranslation[currentPage]);

    i18n.subscribe((comp) => {
        documentUpdater(comp, lang);
    });

    if (!customElements.get("t-taxonomy")) {
        customElements.define("t-taxonomy", makeTranslation(currentPage, i18n));
    }
</script>
