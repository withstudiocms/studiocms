---
import config from 'studiocms:config';
import { StudioCMSRenderer } from 'studiocms:renderer';
import studioCMS_SDK from 'studiocms:sdk';
import studioCMS_SDK_Cache from 'studiocms:sdk/cache';
import Layout from '../layouts/Layout.astro';

// This is here to refresh the cache when needed
const allPages = await studioCMS_SDK_Cache.GET.pages();

if (config.dbStartPage) {
	return Astro.redirect('/start');
}

let { slug } = Astro.params;

if (!slug) {
	slug = 'index';
}

const page = await studioCMS_SDK.GET.databaseEntry.pages.bySlug(slug);

if (!page) {
	return new Response(null, { status: 404 });
}

const { title, description, heroImage, defaultContent } = page;

const content = defaultContent?.content || '';
---

<Layout title={title} description={description} heroImage={heroImage}>
	<main>
		<StudioCMSRenderer content={content} />
	</main>
</Layout>