<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Allure Reports</title>
  <style>
    :root {
      --bg1: #0f1724;
      --bg2: #071129;
      --card: #0b1220;
      --accent: #60a5fa;
      --muted: #9aa7bd;
      --pass: #16a34a;
      --fail: #ef4444;
      --unknown: #9ca3af;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: #e6eef8;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: linear-gradient(180deg, var(--bg1), var(--bg2));
      padding: 28px;
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }

    .wrap {
      width: 100%;
      max-width: 1100px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 18px;
    }

    header h1 {
      font-size: 20px;
      margin: 0;
      color: #fff;
    }

    header .sub {
      color: var(--muted);
      font-size: 13px;
    }

    .card {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
      border: 1px solid rgba(255, 255, 255, 0.04);
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(2, 6, 23, 0.6);
      padding: 14px;
      color: inherit;
    }

    .table-wrap {
      overflow: auto;
      border-radius: 8px;
    }

    table#allureTable {
      width: 100%;
      border-collapse: collapse;
      min-width: 720px;
      color: #dbeafe;
    }

    thead th {
      position: sticky;
      top: 0;
      background: rgba(7, 17, 34, 0.85);
      color: #e6eef8;
      text-align: left;
      padding: 12px 14px;
      font-weight: 600;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
      backdrop-filter: blur(4px);
    }

    tbody td {
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.02);
      vertical-align: middle;
    }

    tbody tr:hover {
      transform: translateY(-2px);
      transition: transform 0.12s ease;
      filter: brightness(1.06);
    }

    tr.test-pass td {
      background: linear-gradient(90deg, rgba(22, 163, 74, 0.06), transparent);
      color: #68fcaf;
    }

    tr.test-fail td {
      background: linear-gradient(90deg, rgba(239, 68, 68, 0.06), transparent);
      color: #ff8888;
    }

    tr.test-unknown td {
      background: linear-gradient(90deg, rgba(156, 163, 175, 0.06), transparent);
      color: #bcd3ff;
    }

    tfoot td {
      padding: 12px 14px;
      font-weight: 700;
      border-top: 2px solid rgba(255, 255, 255, 0.04);
      background: rgba(255, 255, 255, 0.01);
    }

    a.row-link {
      color: var(--accent);
      text-decoration: none;
      font-weight: 600;
    }

    .empty {
      color: var(--muted);
      padding: 24px;
      text-align: center;
    }

    @media (max-width: 760px) {
      .wrap {
        padding: 0 8px;
      }

      thead th,
      tbody td {
        padding: 10px 8px;
      }

      table#allureTable {
        min-width: 640px;
      }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Allure Reports</h1>
        <div class="sub">Listing of test runs â€” updates on load</div>
      </div>
    </header>

    <div class="card table-wrap">
      <table id="allureTable" aria-describedby="allure-desc">
        <thead></thead>
        <tbody></tbody>
        <tfoot></tfoot>
      </table>
      <div id="allure-desc" style="display:none">A table of past Allure test runs with summary statistics and links
      </div>
      <div id="empty" class="empty" style="display:none">No reports found</div>
    </div>
  </div>

  <script type="text/javascript">
    const createTr = (data, cellType = 'td', testResult) => {
      const row = document.createElement('tr')

      if (testResult === 'PASS') {
        row.classList.add('test-pass')
      } else if (testResult === 'FAIL') {
        row.classList.add('test-fail')
      } else if (testResult === 'UNKNOWN') {
        row.classList.add('test-unknown')
      }

      data.forEach((el) => {
        const cell = document.createElement(cellType)
        cell.appendChild(el)
        row.appendChild(cell)
      })
      return row
    }

    const formatDate = (ts) => {
      if (!ts) return ''
      let dateTime = new Date(ts).toISOString().replace('T', ' ')
      dateTime = dateTime.substring(0, dateTime.indexOf('.'))
      return dateTime
    }

    const formatDuration = (dur) => {
      if (typeof dur !== 'number') return ''
      const seconds = Math.round(dur / 1000)
      const minutes = Math.floor(seconds / 60)
      const secondsRemainder = seconds - minutes * 60
      return `${minutes}m ${secondsRemainder}s`
    }

    const allureTable = document.getElementById('allureTable')
    const allureTableHeader = allureTable.getElementsByTagName('thead')[0]
    const allureTableBody = allureTable.getElementsByTagName('tbody')[0]
    const allureTableFooter = allureTable.getElementsByTagName('tfoot')[0]
    const emptyEl = document.getElementById('empty')

    // header data
    const headers = ['Date', 'Pass', 'Fail', 'Skip', 'Total', 'Duration', 'Link'].map((t) => document.createTextNode(t))
    allureTableHeader.appendChild(createTr(headers, 'th'))

    fetch(`./data.json?t=${Date.now()}`)
      .then((response) => response.ok && response.json())
      .then((json) => {
        if (!json || !Array.isArray(json) || json.length === 0) {
          emptyEl.style.display = 'block'
          allureTable.style.display = 'none'
          return
        }

        // footer data
        const totalCount = json.length
        allureTableFooter.appendChild(createTr(['TOTAL', '', '', '', '', '', String(totalCount)].map((t) => document.createTextNode(t))))

        json.forEach((r) => {
          const rowData = []

          rowData.push(document.createTextNode(formatDate(r.timestamp)))
          rowData.push(document.createTextNode(String(r.summary.statistic.passed || 0)))
          rowData.push(document.createTextNode(String((r.summary.statistic.failed || 0) + (r.summary.statistic.broken || 0))))
          rowData.push(document.createTextNode(String(r.summary.statistic.skipped || 0)))
          rowData.push(document.createTextNode(String(r.summary.statistic.total || 0)))
          rowData.push(document.createTextNode(formatDuration(r.summary.time && r.summary.time.duration)))

          const link = document.createElement('a')
          link.className = 'row-link'
          link.href = `./${r.runUniqueId}`
          link.appendChild(document.createTextNode(r.runId || r.runUniqueId || 'report'))
          link.setAttribute('aria-label', `Open report ${r.runId || r.runUniqueId}`)
          rowData.push(link)

          // append row to body
          allureTableBody.appendChild(createTr(rowData, 'td', r.testResult))
        })
      })
      .catch((err) => {
        console.error('Failed to load allure data', err)
        emptyEl.textContent = 'Failed to load data'
        emptyEl.style.display = 'block'
        allureTable.style.display = 'none'
      })
  </script>

</body>

</html>